<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Fetch API</title>
    <head-css></head-css>
    <script src="js/header_footer_template.js"></script>
    <script src="js/prism.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="js/scriptPage4.js" defer></script>
    <script src="https://cdn.jsdelivr.net/gh/ncase/nutshell/nutshell.js"></script>
  </head>

  <body>
    <main-header></main-header>
    <div id="page4">
      <section>
        <p>
          There are many ways to make HTTP requests in JavaScript, and historically, the
          callback-based <code>XMLHttpRequest</code> API was the most prominent. You would
          create a new <code>XMLHttpRequest</code> object and attach an event listener for
          its <code>loadend</code> event. <br />
          However, callback-based code can get hard to understand when you need a series
          of asynchronous functions. You would need a callback that accept a callback that
          accepts another callback, and so on (search Google for
          <kbd>pyramid of doom</kbd>). <br />
          Thankfully, with <code>Promises</code> and <code>Async/Await</code> introduced
          to modern browsers, we now have <code>Fetch</code> API, the promise-based
          replacement for <code>XMLHttpRequest</code>.
        </p>

        <h2>How to use <code>fetch()</code></h2>
        <p>
          Remember our <code>fetchCatImageSync()</code> function from Page 1? Let's
          rewrite it with Promises and Fetch API so that our web can still be responsive
          while the function runs. Furthermore, let try to get a <kbd>random</kbd> cat
          image each time we press the button. <br />
          To do this, we'll make an HTTP request to a remote server of
          <a href="https://thecatapi.com/">The Cat API</a>, and it will send us back a
          JSON response containing the URL of the cat image.
        </p>
        <pre>
          <code class="language-javascript">

          fetch('https://api.thecatapi.com/v1/images/search')
            .then((response) => response.json())
            .then((json)     => {
              console.log(json);
              this.imgsrc = json[0].url;  //assign src to the img element
            })   
          </code>
          <button @click="fetchCatImage">Run</button>

            </pre>
        <div class="notice">
          <h4>Console</h4>
          <p>{{console}}</p>
        </div>
        <img :src="imgsrc" alt="Cat image goes here" />
        <p>So what's going on up there in the code? Let's break it down:</p>
        <ol>
          <li>
            We call the <code>fetch()</code> function, passing it the URL of the cat API.
            This returns a <code>Promise</code>.
          </li>
          <li>
            We call <code>then()</code> on the <code>Promise</code> with the
            <code>(response) => response.json()</code> callback, meaning when the Promise
            is resolved, we will turn the response object into a JSON and return it.
          </li>
          <li>
            We <code>then</code> take that JSON above as an argument and
            <code> log it to the console</code>. You can see in the Console that the JSON
            is an array with 1 element, and that element contains an URL to a cat image.
            We then assign that URL to the <code>imgsrc</code> variable, which is bound to
            the <code>src</code> attribute of the <code>img</code> element above.
          </li>
        </ol>
        Wait, for the <code>fetch()</code> function to return a <code>Promise</code>, it
        must be an asynchronous function, right? So why don't we need to use
        <code>async/await</code> here? <br />
        Well, the <code>fetch()</code> function is a special case. It is a built-in
        function that returns a <code>Promise</code> by default. <br />

        <h2>The Fetch API</h2>
      </section>
      <section>
        <div>
          <h2>Cool References to check out</h2>
          <ul>
            <li>
              <a href="https://www.jsv9000.app/"> Event Loop Visualizer </a>
            </li>
            <li>
              <a href="https://www.youtube.com/watch?v=x3c1ih2NJEg">
                :How does the INTERNET work? | ICT #2
              </a>
            </li>
            <li>
              <a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ">
                :What the heck is the event loop anyway? | Philip Roberts | JSConf EU
              </a>
            </li>
          </ul>
        </div>
      </section>
      <section>
        <p>
          Go back to
          <a href="page3.html">Page 3: API and HTTP Requests</a>
        </p>
      </section>
    </div>

    <main-footer></main-footer>
  </body>
</html>
